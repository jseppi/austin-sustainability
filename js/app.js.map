{"version":3,"sources":["app/app.js","app/scripts/constants.js","app/scripts/controllers/AppCtrl.js","app/scripts/controllers/HomeCtrl.js","app/scripts/controllers/SectionCtrl.js","app/scripts/directives/starHomeSlider.js","app/scripts/directives/starMarkdown.js","app/scripts/directives/starVisualization.js","app/scripts/filters/slugifyFilter.js","app/scripts/services/HomeService.js","app/scripts/services/SectionService.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"_public/js/app.js","sourcesContent":["'use strict';\n\n/* jshint -W079: false */\nvar App = angular.module('app', [\n  'ngAnimate', 'ngSanitize', 'ngTouch', 'ui.router'\n]);\n\n\nApp.config(function ($stateProvider, $urlRouterProvider, SECTIONS) {\n  $stateProvider\n    .state('home', {\n      url: '/',\n      templateUrl: 'partials/home.html',\n      controller: 'HomeCtrl',\n      resolve: {\n        home: function (HomeService) {\n          return HomeService.getContent();\n        },\n        sections: function (SectionService) {\n          return SectionService.getSections();\n        }\n      }\n    });\n\n\n    //Create state for each main section based on slugs\n    //TODO: subsection routes using slugify() on subsection titles\n    _.each(SECTIONS, function (section) {\n      $stateProvider.state(section, {\n        url: '/' + section + '/:subsection/',\n        templateUrl: 'partials/section.html',\n        controller: 'SectionCtrl',\n        resolve: {\n          sections: function (SectionService) {\n            return SectionService.getSections();\n          }\n        }\n      });\n      return;\n    });\n    \n    $urlRouterProvider.otherwise('/');\n    return;\n});\n\nApp.run(function (SectionService, HomeService) {\n  SectionService.getSections();\n  HomeService.getContent();\n});\n","App\n  .constant('CONTENT_PATH', 'content/')\n  .constant('SECTIONS', [\n    'climate_and_energy',\n    'natural_systems',\n    'equity_and_empowerment',\n    'health_and_safety',\n    'arts_education_and_culture',\n    'economy_and_jobs',\n    'built_environment',\n  ])\n  .constant('HOME_STAR', 'content/stars/home/identity_05_main-menu-08.png')\n  ;","'use strict';\n\nApp\n  .controller('AppCtrl', function ($scope, $state) {\n    $scope.sectionClass = 'home';\n\n    $scope.isNodeWebkit = (typeof process === \"object\") && process.versions['node-webkit'];\n\n    $scope.$watch('isNodeWebkit', function () {\n      if ($scope.isNodeWebkit) {\n        var gui = require('nw.gui');\n        var win = gui.Window.get();\n        win.zoomLevel = win.width / 1000;\n      }\n    });\n\n    $scope.closeKiosk = function () {\n      var gui = require('nw.gui');\n      gui.App.quit();\n    };\n\n    $scope.$on('$stateChangeSuccess', function () {\n      $scope.sectionClass = $state.current.name;\n    });\n  });\n","'use strict';\n\nApp.controller('HomeCtrl',\n  function ($scope, $rootScope, $state, home, sections, HOME_STAR) {\n\n    $rootScope.pageTitle = \"Home\";\n\n    $scope.homeContent = home;\n    $scope.sections = sections;\n    $scope.expandedSection = null;\n    $scope.starPath = HOME_STAR;\n    \n    $scope.expandSection = function (section) {\n      if ($scope.expandedSection === section) {\n        $scope.expandedSection = null;\n        $scope.starPath = HOME_STAR;\n      }\n      else {\n        $scope.expandedSection = section;\n        $scope.starPath = section.config.star;\n      }\n    };\n\n  }\n);\n","'use strict';\n\nApp.controller('SectionCtrl', function ($scope, $rootScope, $state, $filter, $stateParams, sections) {\n\n  function goToDefaultSubsection () {\n    $scope.selectedSubsection = _.first($scope.subsections);\n    $state.go($state.current.name, {subsection: slugify($scope.selectedSubsection.title)});\n  }\n\n  var slugify = $filter('slugify');\n  \n  var currentSection = _.find(sections, function (s) {\n    return s.key === $state.current.name; }\n  );\n\n  $scope.sectionName = $state.current.name;\n  $scope.section = currentSection.config;\n  $scope.subsections = currentSection.config.subsections;\n\n  //get the subsection from the stateParams\n  var subsectionParam = $stateParams.subsection;\n\n  if (!subsectionParam || !_.isString(subsectionParam)) {\n    //default to selecting the first subsection \n    goToDefaultSubsection();\n  }\n  else {\n    //try to find the matching subsection\n    $scope.selectedSubsection = _.find($scope.subsections, function (ss) {\n      return subsectionParam.toLowerCase() === slugify(ss.title);\n    });\n\n    //if not found, just default to first subsection\n    if (!$scope.selectedSubsection) {\n      goToDefaultSubsection();\n    }\n  }\n\n  $rootScope.pageTitle = $scope.section.title + \" - \" + $scope.selectedSubsection.title;\n\n});\n","'use strict';\nApp.\n  directive('starHomeSlider', function () {\n    return {\n      restrict: 'A',\n      scope: {\n        slides: '=starHomeSlider'\n      },\n      template: \"\" + \n        \"<div class='home-slider swipable'>\" +\n          \"<ul class='swipe-controls'>\" + \n            \"<li ng-repeat='slide in slides' ng-class='{active: slide.isActive}'>\" +\n              \"<button type='button' title='Click or swipe to see content' ng-click='makeActive(slide)'>{{$index + 1}}</button>\" +\n            \"</li>\" +\n          \"</ul>\" +\n          \"<div ng-repeat='slide in slides' star-home-slider-content='slide'></div>\" +\n        \"</div>\",\n      controller: function ($scope) {\n\n        var numSlides = $scope.slides.length;\n\n        this.nextSlide = function (currSlide) {\n          var currIndex = _.indexOf($scope.slides, currSlide);\n          var nextIndex = (currIndex + 1) % numSlides;\n          $scope.slides[currIndex].isActive = false;\n          $scope.slides[nextIndex].isActive = true;\n        };\n\n        this.prevSlide = function (currSlide) {\n          var currIndex = _.indexOf($scope.slides, currSlide);\n          var prevIndex = (currIndex - 1 < 0) ? numSlides - 1 : currIndex - 1;\n          $scope.slides[currIndex].isActive = false;\n          $scope.slides[prevIndex].isActive = true;\n        };\n      },\n      link: function (scope) {\n        var firstSlide = _.first(scope.slides);\n        firstSlide.isActive = true;\n\n        scope.makeActive = function (slide) {\n          var currActive = _.findWhere(scope.slides, {'isActive': true});\n          currActive.isActive = false;\n          slide.isActive = true;\n        };\n      }\n    };\n  })\n  .directive('starHomeSliderContent', function () {\n    return {\n      restrict: 'A',\n      replace: true,\n      require: '^starHomeSlider',\n      scope: {\n        slide: '=starHomeSliderContent'\n      },\n      template: \"\" +\n        \"<div ng-swipe-right='swipeRight(slide)' ng-swipe-left='swipeLeft(slide)' class='slide-content' ng-show='slide.isActive'>\" +\n          \"<div star-markdown='slide.content'></div>\" +\n          \"<img ng-src='{{slide.image}}' alt='Image for slide'/>\" +\n        \"</div>\",\n      link: function (scope, element, attrs, ctrl) {\n        scope.swipeRight = function (slide) {\n          ctrl.prevSlide(slide);\n        };\n\n        scope.swipeLeft = function (slide) {\n          ctrl.nextSlide(slide);\n        };\n      }\n    };\n  });","'use strict';\n// Based on btford/angular-markdown-directive\n// https://github.com/btford/angular-markdown-directive\n\n// Requires marked and ngSanitize \n\n// Specify markdown content as\n//   as scope variable: <div star-markdown=\"someScopeVar\"></div>\n//   as file: <div star-markdown ng-include=\"'myfile.md'\"></div>\n//   as html node content <div star-markdown># Title</div> \nApp.\n  directive('starMarkdown', function ($sanitize) {\n    return {\n      restrict: 'A',\n      link: function (scope, element, attrs) {\n        if (attrs.starMarkdown) {\n          scope.$watch(attrs.starMarkdown, function (newVal) {\n            var html = newVal ? $sanitize(marked(newVal)) : '';\n            element.html(html);\n          });\n        } else {\n          var html = $sanitize(marked(element.text()));\n          element.html(html);\n        }\n      }\n    };\n  });","'use strict';\nApp.\n  directive('starVisualization', function () {\n    return {\n      restrict: 'A',\n      scope: {\n        visualizations: '=starVisualization'\n      },\n      template: \"\" + \n        \"<div class='visualization-slider swipable'>\" +\n          \"<ul ng-if='visualizations.length > 1' class='swipe-controls'>\" + \n            \"<li ng-repeat='vis in visualizations' ng-class='{active: vis.isActive}'>\" +\n              \"<button type='button' title='Click or swipe to see content' ng-click='makeActive(vis)'>{{$index + 1}}</button>\" +\n            \"</li>\" +\n          \"</ul>\" +\n          \"<div ng-repeat='vis in visualizations' star-visualization-content='vis'></div>\" +\n        \"</div>\",\n      controller: function ($scope) {\n\n        var numVisualizations = $scope.visualizations.length;\n\n        this.nextVis = function (currVis) {\n          var currIndex = _.indexOf($scope.visualizations, currVis);\n          var nextIndex = (currIndex + 1) % numVisualizations;\n          $scope.visualizations[currIndex].isActive = false;\n          $scope.visualizations[nextIndex].isActive = true;\n        };\n\n        this.prevVis = function (currVis) {\n          var currIndex = _.indexOf($scope.visualizations, currVis);\n          var prevIndex = (currIndex - 1 < 0) ? numVisualizations - 1 : currIndex - 1;\n          $scope.visualizations[currIndex].isActive = false;\n          $scope.visualizations[prevIndex].isActive = true;\n        };\n      },\n      link: function (scope) {\n        var firstVis = _.first(scope.visualizations);\n        firstVis.isActive = true;\n\n        scope.makeActive = function (vis) {\n          var currActive = _.findWhere(scope.visualizations, {'isActive': true});\n          currActive.isActive = false;\n          vis.isActive = true;\n        };\n      }\n    };\n  })\n  .directive('starVisualizationContent', function () {\n    return {\n      restrict: 'A',\n      replace: true,\n      require: '^starVisualization',\n      scope: {\n        vis: '=starVisualizationContent'\n      },\n      template: \"\" +\n        \"<div ng-swipe-right='swipeRight(vis)' ng-swipe-left='swipeLeft(vis)' class='vis-container' ng-show='vis.isActive'>\" +\n          \"<h4 class='vis-title' ng-if='vis.title'>{{vis.title}}</h4>\" +\n          \"<div class='vis-description' ng-if='vis.description'>{{vis.description}}</div>\" +\n          \"<div class='vis-graphic-container'>\" +\n            \"<img ng-src='{{vis.graphic}}' alt='Visualization' />\" +\n          \"</div>\" +\n        \"</div>\",\n      link: function (scope, element, attrs, ctrl) {\n        scope.swipeRight = function (vis) {\n          ctrl.prevVis(vis);\n        };\n\n        scope.swipeLeft = function (vis) {\n          ctrl.nextVis(vis);\n        };\n      }\n    };\n  });","'use strict';\n\nApp.filter('slugify', function() {\n\n  function slugify(text) {\n    return text.toString().toLowerCase()\n      .replace(/\\s+/g, '_')           // Replace spaces with _\n      .replace(/[^\\w\\-]+/g, '')       // Remove all non-word chars\n      .replace(/\\-\\-+/g, '_')         // Replace multiple _ with single _\n      .replace(/^_+/, '')             // Trim _ from start of text\n      .replace(/_+$/, '');            // Trim _ from end of text\n  }\n\n  return function(input) {\n    return input && _.isString(input) ? slugify(input) : ''; \n  };\n\n});","'use strict';\n\nApp.factory('HomeService', function ($http, $q, CONTENT_PATH) {\n\n  var service = {};\n\n  service.getContent = function () {\n\n    var path = CONTENT_PATH + 'home.yml';\n    return $http.get(path, {cache: true})\n      .then(function (response) {\n        var homeConfig = response.data;\n        return jsyaml.load(homeConfig)\n      });\n  };\n\n  return service;\n});","'use strict';\n\nApp.factory('SectionService', function ($http, $q, CONTENT_PATH, SECTIONS) {\n\n  var service = {};\n\n  service.getSections = function () {\n    var promises = _.map(SECTIONS, function (section) {\n      var path = CONTENT_PATH + section + \".yml\";\n      return $http.get(path, {cache: true})\n        .then(function (response) {\n          var sectionConfig = response.data;\n          return {\n            key: section,\n            config: jsyaml.load(sectionConfig)\n          };\n        });\n    });\n\n    return $q.all(promises);\n  };\n\n  return service;\n});"]}